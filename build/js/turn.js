!function(p){"use strict";var r,m="",T=Math.PI,G=T/2,h="ontouchstart"in window,s=h?{start:"touchstart",move:"touchmove",end:"touchend"}:{start:"mousedown",move:"mousemove",end:"mouseup"},n={backward:["bl","tl"],forward:["br","tr"],all:["tl","bl","tr","br"]},o=["single","double"],l={page:1,gradients:!0,duration:600,acceleration:!0,display:"double",when:null},e={folding:null,corners:"forward",cornerSize:100,gradients:!0,duration:600,acceleration:!0},g={0:{top:0,left:0,right:"auto",bottom:"auto"},1:{top:0,right:0,left:"auto",bottom:"auto"}},d=function(t,a,e,i){return{css:{position:"absolute",top:t,left:a,overflow:i||"hidden","z-index":e||"auto"}}},f=function(t,a,e,i,r){var s=1-r,n=s*s*s,o=r*r*r;return E(Math.round(n*t.x+3*r*s*s*a.x+3*r*r*s*e.x+o*i.x),Math.round(n*t.y+3*r*s*s*a.y+3*r*r*s*e.y+o*i.y))},E=function(t,a){return{x:t,y:a}},q=function(t,a,e){return r&&e?" translate3d("+t+"px,"+a+"px, 0px) ":" translate("+t+"px, "+a+"px) "},I=function(t){return" rotate("+t+"deg) "},c=function(t,a){return Object.prototype.hasOwnProperty.call(a,t)},S=function(t,a,e,i,r){var s,n=[];if("-webkit-"==m){for(s=0;s<r;s++)n.push("color-stop("+i[s][0]+", "+i[s][1]+")");t.css({"background-image":"-webkit-gradient(linear, "+a.x+"% "+a.y+"%,  "+e.x+"% "+e.y+"%, "+n.join(",")+" )"})}else{a={x:a.x/100*t.width(),y:a.y/100*t.height()};var o=(e={x:e.x/100*t.width(),y:e.y/100*t.height()}).x-a.x,p=e.y-a.y,h=Math.atan2(p,o),l=h-Math.PI/2,g=Math.abs(t.width()*Math.sin(l))+Math.abs(t.height()*Math.cos(l)),d=Math.sqrt(p*p+o*o),f=E(e.x<a.x?t.width():0,e.y<a.y?t.height():0),c=Math.tan(h),u=-1/c,v=(u*f.x-f.y-c*a.x+a.y)/(u-c),w=v,b=u*v-u*f.x+f.y,x=Math.sqrt(Math.pow(w-a.x,2)+Math.pow(b-a.y,2));for(s=0;s<r;s++)n.push(" "+i[s][1]+" "+100*(x+d*i[s][0])/g+"%");t.css({"background-image":m+"linear-gradient("+-h+"rad,"+n.join(",")+")"})}},u={init:function(t){void 0===r&&(r="WebKitCSSMatrix"in window||"MozPerspective"in document.body.style,m=function(){for(var t=["Moz","Webkit","Khtml","O","ms"],a=t.length,e="";a--;)t[a]+"Transform"in document.body.style&&(e="-"+t[a].toLowerCase()+"-");return e}());var a,e=this.data(),i=this.children();if(t=p.extend({width:this.width(),height:this.height()},l,t),e.opts=t,e.pageObjs={},e.pages={},e.pageWrap={},e.pagePlace={},e.pageMv=[],e.totalPages=t.pages||0,t.when)for(a in t.when)c(a,t.when)&&this.bind(a,t.when[a]);for(this.css({position:"relative",width:t.width,height:t.height}),this.turn("display",t.display),r&&!h&&t.acceleration&&this.transform(q(0,0,!0)),a=0;a<i.length;a++)this.turn("addPage",i[a],a+1);return this.turn("page",t.page),n=p.extend({},n,t.corners),p(this).bind(s.start,function(t){for(var a in e.pages)if(c(a,e.pages)&&!1===Z._eventStart.call(e.pages[a],t))return!1}),p(document).bind(s.move,function(t){for(var a in e.pages)c(a,e.pages)&&Z._eventMove.call(e.pages[a],t)}).bind(s.end,function(t){for(var a in e.pages)c(a,e.pages)&&Z._eventEnd.call(e.pages[a],t)}),e.done=!0,this},addPage:function(t,a){var e=!1,i=this.data(),r=i.totalPages+1;if(a){if(a==r)a=r,e=!0;else if(r<a)throw new Error('It is impossible to add the page "'+a+'", the maximum value is: "'+r+'"')}else a=r,e=!0;return 1<=a&&a<=r&&(i.done&&this.turn("stop"),a in i.pageObjs&&u._movePages.call(this,a,1),e&&(i.totalPages=r),i.pageObjs[a]=p(t).addClass("turn-page p"+a),u._addPage.call(this,a),i.done&&this.turn("update"),u._removeFromDOM.call(this)),this},_addPage:function(t){var a=this.data(),e=a.pageObjs[t];if(e)if(u._necessPage.call(this,t)){if(!a.pageWrap[t]){var i="double"==a.display?this.width()/2:this.width(),r=this.height();e.css({width:i,height:r}),a.pagePlace[t]=t,a.pageWrap[t]=p("<div/>",{class:"turn-page-wrapper",page:t,css:{position:"absolute",overflow:"hidden",width:i,height:r}}).css(g["double"==a.display?t%2:0]),this.append(a.pageWrap[t]),a.pageWrap[t].prepend(a.pageObjs[t])}t&&1!=u._setPageLoc.call(this,t)||u._makeFlip.call(this,t)}else a.pagePlace[t]=0,a.pageObjs[t]&&a.pageObjs[t].remove()},hasPage:function(t){return t in this.data().pageObjs},_makeFlip:function(t){var a=this.data();if(!a.pages[t]&&a.pagePlace[t]==t){var e="single"==a.display,i=t%2;a.pages[t]=a.pageObjs[t].css({width:e?this.width():this.width()/2,height:this.height()}).flip({page:t,next:e&&t===a.totalPages?t-1:i||e?t+1:t-1,turn:this,duration:a.opts.duration,acceleration:a.opts.acceleration,corners:e?"all":i?"forward":"backward",backGradient:a.opts.gradients,frontGradient:a.opts.gradients}).flip("disable",a.disabled).bind("pressed",u._pressed).bind("released",u._released).bind("start",u._start).bind("end",u._end).bind("flip",u._flip)}return a.pages[t]},_makeRange:function(){this.data();var t,a=this.turn("range");for(t=a[0];t<=a[1];t++)u._addPage.call(this,t)},range:function(t){var a,e,i,r=this.data();t=t||r.tpage||r.page;var s=u._view.call(this,t);if(t<1||t>r.totalPages)throw new Error('"'+t+'" is not a page for range');return s[1]=s[1]||s[0],1<=s[0]&&s[1]<=r.totalPages?(a=Math.floor(2),r.totalPages-s[1]>s[0]?i=2*a-(e=Math.min(s[0]-1,a)):e=2*a-(i=Math.min(r.totalPages-s[1],a))):i=e=5,[Math.max(1,s[0]-e),Math.min(r.totalPages,s[1]+i)]},_necessPage:function(t){if(0===t)return!0;var a=this.turn("range");return t>=a[0]&&t<=a[1]},_removeFromDOM:function(){var t,a=this.data();for(t in a.pageWrap)c(t,a.pageWrap)&&!u._necessPage.call(this,t)&&u._removePageFromDOM.call(this,t)},_removePageFromDOM:function(t){var a=this.data();if(a.pages[t]){var e=a.pages[t].data();e.f&&e.f.fwrapper&&e.f.fwrapper.remove(),a.pages[t].remove(),delete a.pages[t]}a.pageObjs[t]&&a.pageObjs[t].remove(),a.pageWrap[t]&&(a.pageWrap[t].remove(),delete a.pageWrap[t]),delete a.pagePlace[t]},removePage:function(t){var a=this.data();return a.pageObjs[t]&&(this.turn("stop"),u._removePageFromDOM.call(this,t),delete a.pageObjs[t],u._movePages.call(this,t,-1),a.totalPages=a.totalPages-1,u._makeRange.call(this),a.page>a.totalPages&&this.turn("page",a.totalPages)),this},_movePages:function(t,i){var a,r=this.data(),s="single"==r.display,e=function(t){var a=t+i,e=a%2;r.pageObjs[t]&&(r.pageObjs[a]=r.pageObjs[t].removeClass("page"+t).addClass("page"+a)),r.pagePlace[t]&&r.pageWrap[t]&&(r.pagePlace[a]=a,r.pageWrap[a]=r.pageWrap[t].css(g[s?0:e]).attr("page",a),r.pages[t]&&(r.pages[a]=r.pages[t].flip("options",{page:a,next:s||e?a+1:a-1,corners:s?"all":e?"forward":"backward"})),i&&(delete r.pages[t],delete r.pagePlace[t],delete r.pageObjs[t],delete r.pageWrap[t],delete r.pageObjs[t]))};if(0<i)for(a=r.totalPages;t<=a;a--)e(a);else for(a=t;a<=r.totalPages;a++)e(a)},display:function(t){var a=this.data(),e=a.display;if(t){if(-1==p.inArray(t,o))throw new Error('"'+t+'" is not a value for display');if("single"==t?a.pageObjs[0]||(this.turn("stop").css({overflow:"hidden"}),a.pageObjs[0]=p("<div />",{class:"turn-page p-temporal"}).css({width:this.width(),height:this.height()}).appendTo(this)):a.pageObjs[0]&&(this.turn("stop").css({overflow:""}),a.pageObjs[0].remove(),delete a.pageObjs[0]),a.display=t,e){var i=this.turn("size");u._movePages.call(this,1,0),this.turn("size",i.width,i.height).turn("update")}return this}return e},animating:function(){return 0<this.data().pageMv.length},disable:function(t){var a,e=this.data(),i=this.turn("view");for(a in e.disabled=void 0===t||!0===t,e.pages)c(a,e.pages)&&e.pages[a].flip("disable",!!t&&p.inArray(a,i));return this},size:function(t,a){if(t&&a){var e,i=this.data(),r="double"==i.display?t/2:t;for(e in this.css({width:t,height:a}),i.pageObjs[0]&&i.pageObjs[0].css({width:r,height:a}),i.pageWrap)c(e,i.pageWrap)&&(i.pageObjs[e].css({width:r,height:a}),i.pageWrap[e].css({width:r,height:a}),i.pages[e]&&i.pages[e].css({width:r,height:a}));return this.turn("resize"),this}return{width:this.width(),height:this.height()}},resize:function(){var t,a=this.data();for(a.pages[0]&&(a.pageWrap[0].css({left:-this.width()}),a.pages[0].flip("resize",!0)),t=1;t<=a.totalPages;t++)a.pages[t]&&a.pages[t].flip("resize",!0)},_removeMv:function(t){var a,e=this.data();for(a=0;a<e.pageMv.length;a++)if(e.pageMv[a]==t)return e.pageMv.splice(a,1),!0;return!1},_addMv:function(t){var a=this.data();u._removeMv.call(this,t),a.pageMv.push(t)},_view:function(t){var a=this.data();return t=t||a.page,"double"==a.display?t%2?[t-1,t]:[t,t+1]:[t]},view:function(t){var a=this.data(),e=u._view.call(this,t);return"double"==a.display?[0<e[0]?e[0]:0,e[1]<=a.totalPages?e[1]:0]:[0<e[0]&&e[0]<=a.totalPages?e[0]:0]},stop:function(t){var a,e,i=this.data(),r=i.pageMv;for(a in i.pageMv=[],i.tpage&&(i.page=i.tpage,delete i.tpage),r)c(a,r)&&(e=i.pages[r[a]].data().f.opts,Z._moveFoldingPage.call(i.pages[r[a]],null),i.pages[r[a]].flip("hideFoldedPage"),i.pagePlace[e.next]=e.next,e.force&&(e.next=e.page%2==0?e.page-1:e.page+1,delete e.force));return this.turn("update"),this},pages:function(t){var a=this.data();if(t){if(t<a.totalPages){for(var e=t+1;e<=a.totalPages;e++)this.turn("removePage",e);this.turn("page")>t&&this.turn("page",t)}return a.totalPages=t,this}return a.totalPages},_fitPage:function(t,a){var e=this.data(),i=this.turn("view",t);e.page!=t&&(this.trigger("turning",[t,i]),-1!=p.inArray(1,i)&&this.trigger("first"),-1!=p.inArray(e.totalPages,i)&&this.trigger("last")),e.pageObjs[t]&&(e.tpage=t,this.turn("stop",a),u._removeFromDOM.call(this),u._makeRange.call(this),this.trigger("turned",[t,i]))},_turnPage:function(t){var a,e,i=this.data(),r=this.turn("view"),s=this.turn("view",t);if(i.page!=t&&(this.trigger("turning",[t,s]),-1!=p.inArray(1,s)&&this.trigger("first"),-1!=p.inArray(i.totalPages,s)&&this.trigger("last")),i.pageObjs[t]&&(i.tpage=t,this.turn("stop"),u._makeRange.call(this),"single"==i.display?(a=r[0],e=s[0]):r[1]&&t>r[1]?(a=r[1],e=s[0]):r[0]&&t<r[0]&&(a=r[0],e=s[1]),i.pages[a])){var n=i.pages[a].data().f.opts;i.tpage=e,n.next!=e&&(n.next=e,i.pagePlace[e]=n.page,n.force=!0),"single"==i.display?i.pages[a].flip("turnPage",s[0]>r[0]?"br":"bl"):i.pages[a].flip("turnPage")}},page:function(t){t=parseInt(t,10);var a=this.data();return 0<t&&t<=a.totalPages?(a.done&&-1==p.inArray(t,this.turn("view"))?u._turnPage.call(this,t):u._fitPage.call(this,t),this):a.page},next:function(){var t=this.data();return this.turn("page",u._view.call(this,t.page).pop()+1)},previous:function(){var t=this.data();return this.turn("page",u._view.call(this,t.page).shift()-1)},_addMotionPage:function(){var t=p(this).data().f.opts,a=t.turn,e=a.data();t.pageMv=t.page,u._addMv.call(a,t.pageMv),e.pagePlace[t.next]=t.page,a.turn("update")},_start:function(t,a,e){var i=a.turn.data(),r=p.Event("start");if(t.stopPropagation(),a.turn.trigger(r,[a,e]),r.isDefaultPrevented())t.preventDefault();else{if("single"==i.display){var s="l"==e.charAt(1);1==a.page&&s||a.page==i.totalPages&&!s?t.preventDefault():s?(a.next=a.next<a.page?a.next:a.page-1,a.force=!0):a.next=a.next>a.page?a.next:a.page+1}u._addMotionPage.call(this)}},_end:function(t,a){var e=p(this).data().f.opts,i=e.turn,r=i.data();t.stopPropagation(),a||r.tpage?r.tpage!=e.next&&r.tpage!=e.page||(delete r.tpage,u._fitPage.call(i,r.tpage||e.next,!0)):(u._removeMv.call(i,e.pageMv),i.turn("update"))},_pressed:function(){var t,a=p(this).data().f,e=a.opts.turn.data().pages;for(t in e)t!=a.opts.page&&e[t].flip("disable",!0);return a.time=(new Date).getTime()},_released:function(t,a){var e=p(this),i=e.data().f;t.stopPropagation(),((new Date).getTime()-i.time<200||a.x<0||a.x>p(this).width())&&(t.preventDefault(),i.opts.turn.data().tpage=i.opts.next,i.opts.turn.turn("update"),p(e).flip("turnPage"))},_flip:function(){var t=p(this).data().f.opts;t.turn.trigger("turn",[t.next])},calculateZ:function(t){var a,e,i,r,s,n=this,o=this.data(),p=this.turn("view"),h=p[0]||p[1],l={pageZ:{},partZ:{},pageV:{}},g=function(t){var a=n.turn("view",t);a[0]&&(l.pageV[a[0]]=!0),a[1]&&(l.pageV[a[1]]=!0)};for(a=0;a<t.length;a++)e=t[a],i=o.pages[e].data().f.opts.next,r=o.pagePlace[e],g(e),g(i),s=o.pagePlace[i]==i?i:e,l.pageZ[s]=o.totalPages-Math.abs(h-s),l.partZ[r]=2*o.totalPages+Math.abs(h-s);return l},update:function(){var t,a=this.data();if(a.pageMv.length&&0!==a.pageMv[0]){var e=this.turn("calculateZ",a.pageMv),i=this.turn("view",a.tpage);for(t in a.pagePlace[i[0]]==i[0]?i[0]:a.pagePlace[i[1]]==i[1]&&i[1],a.pageWrap)c(t,a.pageWrap)&&(a.pageWrap[t].css({display:e.pageV[t]?"":"none","z-index":e.pageZ[t]||0}),a.pages[t]&&(a.pages[t].flip("z",e.partZ[t]||null),e.pageV[t]&&a.pages[t].flip("resize"),a.tpage&&a.pages[t].flip("disable",!0)))}else for(t in a.pageWrap)if(c(t,a.pageWrap)){var r=u._setPageLoc.call(this,t);a.pages[t]&&a.pages[t].flip("disable",a.disabled||1!=r).flip("z",null)}},_setPageLoc:function(t){var a=this.data(),e=this.turn("view");return t==e[0]||t==e[1]?(a.pageWrap[t].css({"z-index":a.totalPages,display:""}),1):"single"==a.display&&t==e[0]+1||"double"==a.display&&t==e[0]-2||t==e[1]+2?(a.pageWrap[t].css({"z-index":a.totalPages-1,display:""}),2):(a.pageWrap[t].css({"z-index":0,display:"none"}),0)}},Z={init:function(t){return t.gradients&&(t.frontGradient=!0,t.backGradient=!0),this.data({f:{}}),this.flip("options",t),Z._addPageWrapper.call(this),this},setData:function(t){var a=this.data();return a.f=p.extend(a.f,t),this},options:function(t){var a=this.data().f;return t?(Z.setData.call(this,{opts:p.extend({},a.opts||e,t)}),this):a.opts},z:function(t){var a=this.data().f;return a.opts["z-index"]=t,a.fwrapper.css({"z-index":t||parseInt(a.parent.css("z-index"),10)||0}),this},_cAllowed:function(){return n[this.data().f.opts.corners]||this.data().f.opts.corners},_cornerActivated:function(t){if(void 0===t.originalEvent)return!1;t=h?t.originalEvent.touches:[t];var a=this.data().f,e=a.parent.offset(),i=this.width(),r=this.height(),s={x:Math.max(0,t[0].pageX-e.left),y:Math.max(0,t[0].pageY-e.top)},n=a.opts.cornerSize,o=Z._cAllowed.call(this);if(s.x<=0||s.y<=0||s.x>=i||s.y>=r)return!1;if(s.y<n)s.corner="t";else{if(!(s.y>=r-n))return!1;s.corner="b"}if(s.x<=n)s.corner+="l";else{if(!(s.x>=i-n))return!1;s.corner+="r"}return-1!=p.inArray(s.corner,o)&&s},_c:function(t,a){return{tl:E(a=a||0,a),tr:E(this.width()-a,a),bl:E(a,this.height()-a),br:E(this.width()-a,this.height()-a)}[t]},_c2:function(t){return{tl:E(2*this.width(),0),tr:E(-this.width(),0),bl:E(2*this.width(),this.height()),br:E(-this.width(),this.height())}[t]},_foldingPage:function(t){var a=this.data().f.opts;if(a.folding)return a.folding;if(a.turn){var e=a.turn.data();return"single"==e.display?e.pageObjs[a.next]?e.pageObjs[0]:null:e.pageObjs[a.next]}},_backGradient:function(){var t=this.data().f,a=t.opts.turn,e=t.opts.backGradient&&(!a||"single"==a.data().display||2!=t.opts.page&&t.opts.page!=a.data().totalPages-1);return e&&!t.bshadow&&(t.bshadow=p("<div/>",d(0,0,1)).css({position:"",width:this.width(),height:this.height()}).appendTo(t.parent)),e},resize:function(t){var a=this.data().f,e=this.width(),i=this.height(),r=Math.round(Math.sqrt(Math.pow(e,2)+Math.pow(i,2)));t&&(a.wrapper.css({width:r,height:r}),a.fwrapper.css({width:r,height:r}).children(":first-child").css({width:e,height:i}),a.fpage.css({width:i,height:e}),a.opts.frontGradient&&a.ashadow.css({width:i,height:e}),Z._backGradient.call(this)&&a.bshadow.css({width:e,height:i})),a.parent.is(":visible")&&(a.fwrapper.css({top:a.parent.offset().top,left:a.parent.offset().left}),a.opts.turn&&a.fparent.css({top:-a.opts.turn.offset().top,left:-a.opts.turn.offset().left})),this.flip("z",a.opts["z-index"])},_addPageWrapper:function(){var t=this.data().f,a=this.parent();if(!t.wrapper){this.css("left"),this.css("top");var e=this.width(),i=this.height();Math.round(Math.sqrt(Math.pow(e,2)+Math.pow(i,2)));if(t.parent=a,t.fparent=t.opts.turn?t.opts.turn.data().fparent:p("#turn-fwrappers"),!t.fparent){var r=p("<div/>",{css:{"pointer-events":"none"}}).hide();r.data().flips=0,t.opts.turn?(r.css(d(-t.opts.turn.offset().top,-t.opts.turn.offset().left,"auto","visible").css).appendTo(t.opts.turn),t.opts.turn.data().fparent=r):r.css(d(0,0,"auto","visible").css).attr("id","turn-fwrappers").appendTo(p("body")),t.fparent=r}this.css({position:"absolute",top:0,left:0,bottom:"auto",right:"auto"}),t.wrapper=p("<div/>",d(0,0,this.css("z-index"))).appendTo(a).prepend(this),t.fwrapper=p("<div/>",d(a.offset().top,a.offset().left)).hide().appendTo(t.fparent),t.fpage=p("<div/>",{css:{cursor:"default"}}).appendTo(p("<div/>",d(0,0,0,"visible")).appendTo(t.fwrapper)),t.opts.frontGradient&&(t.ashadow=p("<div/>",d(0,0,1)).appendTo(t.fpage)),Z.setData.call(this,t),Z.resize.call(this,!0)}},_fold:function(d){var f,c,u,v,w,b,x=this,m=0,y=0,P=E(0,0),M=E(0,0),_=E(0,0),O=this.width(),j=this.height(),t=Z._foldingPage.call(this),W=(Math.tan(y),this.data().f),h=W.opts.acceleration,z=W.wrapper.height(),k=Z._c.call(this,d.corner),F="t"==d.corner.substr(0,1),D="l"==d.corner.substr(1,1),A=function(){var t,a=E(k.x?k.x-d.x:d.x,k.y?k.y-d.y:d.y),e=Math.atan2(a.y,a.x);m=(y=G-e)/T*180,t=E(D?O-a.x/2:d.x+a.x/2,a.y/2);var i=y-Math.atan2(t.y,t.x),r=Math.max(0,Math.sin(i)*Math.sqrt(Math.pow(t.x,2)+Math.pow(t.y,2)));if(_=E(r*Math.sin(y),r*Math.cos(y)),G<y&&(_.x=_.x+Math.abs(_.y*Math.tan(e)),_.y=0,Math.round(_.x*Math.tan(T-y))<j))return d.y=Math.sqrt(Math.pow(j,2)+2*t.x*a.x),F&&(d.y=j-d.y),A();if(G<y){var s=T-y,n=z-j/Math.sin(s);P=E(Math.round(n*Math.cos(s)),Math.round(n*Math.sin(s))),D&&(P.x=-P.x),F&&(P.y=-P.y)}f=Math.round(_.y/Math.tan(y)+_.x);var o=O-f,p=o*Math.cos(2*y),h=o*Math.sin(2*y);M=E(Math.round(D?o-p:f+p),Math.round(F?h:j-h)),w=o*Math.sin(y);var l=Z._c2.call(x,d.corner),g=Math.sqrt(Math.pow(l.x-d.x,2)+Math.pow(l.y-d.y,2));return b=g<O?g/O:1,W.opts.frontGradient&&(v=100<w?(w-100)/w:0,c=E(w*Math.sin(G-y)/j*100,w*Math.cos(G-y)/O*100),F&&(c.y=100-c.y),D&&(c.x=100-c.x)),Z._backGradient.call(x)&&(u=E(w*Math.sin(y)/O*100,w*Math.cos(y)/j*100),D||(u.x=100-u.x),F||(u.y=100-u.y)),_.x=Math.round(_.x),_.y=Math.round(_.y),!0},a=function(t,a,e,i){var r=["0","auto"],s=(O-z)*e[0]/100,n=(j-z)*e[1]/100,o={left:r[a[0]],top:r[a[1]],right:r[a[2]],bottom:r[a[3]]},p=90!=i&&-90!=i?D?-1:1:0;e=e[0]+"% "+e[1]+"%",x.css(o).transform(I(i)+q(t.x+p,t.y,h),e),W.fpage.parent().css(o),W.wrapper.transform(q(-t.x+s-p,-t.y+n,h)+I(-i),e),W.fwrapper.transform(q(-t.x+P.x+s,-t.y+P.y+n,h)+I(-i),e),W.fpage.parent().transform(I(i)+q(t.x+M.x-P.x,t.y+M.y-P.y,h),e),W.opts.frontGradient&&S(W.ashadow,E(D?100:0,F?100:0),E(c.x,c.y),[[v,"rgba(0,0,0,0)"],[.8*(1-v)+v,"rgba(0,0,0,"+.2*b+")"],[1,"rgba(255,255,255,"+.2*b+")"]],3),Z._backGradient.call(x)&&S(W.bshadow,E(D?0:100,F?0:100),E(u.x,u.y),[[.8,"rgba(0,0,0,0)"],[1,"rgba(0,0,0,"+.3*b+")"],[1,"rgba(0,0,0,0)"]],3)};switch(d.corner){case"tl":d.x=Math.max(d.x,1),A(),a(_,[1,0,0,1],[100,0],m),W.fpage.transform(q(-j,-O,h)+I(90-2*m),"100% 100%"),t.transform(I(90)+q(0,-j,h),"0% 0%");break;case"tr":d.x=Math.min(d.x,O-1),A(),a(E(-_.x,_.y),[0,0,0,1],[0,0],-m),W.fpage.transform(q(0,-O,h)+I(2*m-90),"0% 100%"),t.transform(I(270)+q(-O,0,h),"0% 0%");break;case"bl":d.x=Math.max(d.x,1),A(),a(E(_.x,-_.y),[1,1,0,0],[100,100],-m),W.fpage.transform(q(-j,0,h)+I(2*m-90),"100% 0%"),t.transform(I(270)+q(-O,0,h),"0% 0%");break;case"br":d.x=Math.min(d.x,O-1),A(),a(E(-_.x,-_.y),[0,1,1,0],[0,100],m),W.fpage.transform(I(90-2*m),"0% 0%"),t.transform(I(90)+q(0,-j,h),"0% 0%")}W.point=d},_moveFoldingPage:function(t){var a=this.data().f,e=Z._foldingPage.call(this);e&&(t?a.fpage.children()[a.ashadow?"1":"0"]||(Z.setData.call(this,{backParent:e.parent()}),a.fpage.prepend(e)):a.backParent&&a.backParent.prepend(e))},_showFoldedPage:function(a,t){var e=Z._foldingPage.call(this),i=this.data(),r=i.f;if(!r.point||r.point.corner!=a.corner){var s=p.Event("start");if(this.trigger(s,[r.opts,a.corner]),s.isDefaultPrevented())return!1}if(e){if(t){var n=this,o=r.point&&r.point.corner==a.corner?r.point:Z._c.call(this,a.corner,1);this.animatef({from:[o.x,o.y],to:[a.x,a.y],duration:500,frame:function(t){a.x=Math.round(t[0]),a.y=Math.round(t[1]),Z._fold.call(n,a)}})}else Z._fold.call(this,a),i.effect&&!i.effect.turning&&this.animatef(!1);return r.fwrapper.is(":visible")||(r.fparent.show().data().flips++,Z._moveFoldingPage.call(this,!0),r.fwrapper.show(),r.bshadow&&r.bshadow.show()),!0}return!1},hide:function(){var t=this.data().f,a=Z._foldingPage.call(this);return 0==--t.fparent.data().flips&&t.fparent.hide(),this.css({left:0,top:0,right:"auto",bottom:"auto"}).transform("","0% 100%"),t.wrapper.transform("","0% 100%"),t.fwrapper.hide(),t.bshadow&&t.bshadow.hide(),a.transform("","0% 0%"),this},hideFoldedPage:function(t){var a=this.data().f;if(a.point){var e=this,i=a.point,r=function(){a.point=null,e.flip("hide"),e.trigger("end",[!1])};if(t){var s=Z._c.call(this,i.corner),n="t"==i.corner.substr(0,1)?Math.min(0,i.y-s.y)/2:Math.max(0,i.y-s.y)/2,o=E(i.x,i.y+n),p=E(s.x,s.y-n);this.animatef({from:0,to:1,frame:function(t){var a=f(i,o,p,s,t);i.x=a.x,i.y=a.y,Z._fold.call(e,i)},complete:r,duration:800,hiding:!0})}else this.animatef(!1),r()}},turnPage:function(e){var i=this,t=this.data().f;e={corner:t.corner?t.corner.corner:e||Z._cAllowed.call(this)[0]};var r=t.point||Z._c.call(this,e.corner,t.opts.turn?t.opts.turn.data().opts.elevation:0),s=Z._c2.call(this,e.corner);this.trigger("flip").animatef({from:0,to:1,frame:function(t){var a=f(r,r,s,s,t);e.x=a.x,e.y=a.y,Z._showFoldedPage.call(i,e)},complete:function(){i.trigger("end",[!0])},duration:t.opts.duration,turning:!0}),t.corner=null},moving:function(){return"effect"in this.data()},isTurning:function(){return this.flip("moving")&&this.data().effect.turning},_eventStart:function(t){var a=this.data().f;if(!a.disabled&&!this.flip("isTurning")){if(a.corner=Z._cornerActivated.call(this,t),a.corner&&Z._foldingPage.call(this,a.corner))return Z._moveFoldingPage.call(this,!0),this.trigger("pressed",[a.point]),!1;a.corner=null}},_eventMove:function(t){var a=this.data().f;if(!a.disabled)if(t=h?t.originalEvent.touches:[t],a.corner){var e=a.parent.offset();a.corner.x=t[0].pageX-e.left,a.corner.y=t[0].pageY-e.top,Z._showFoldedPage.call(this,a.corner)}else if(!this.data().effect&&this.is(":visible")){var i=Z._cornerActivated.call(this,t[0]);if(i){var r=Z._c.call(this,i.corner,a.opts.cornerSize/2);i.x=r.x,i.y=r.y,Z._showFoldedPage.call(this,i,!0)}else Z.hideFoldedPage.call(this,!0)}},_eventEnd:function(){var t=this.data().f;if(!t.disabled&&t.point){var a=p.Event("released");this.trigger(a,[t.point]),a.isDefaultPrevented()||Z.hideFoldedPage.call(this,!0)}t.corner=null},disable:function(t){return Z.setData.call(this,{disabled:t}),this}},i=function(t,a,e){if(e[0]&&"object"!=typeof e[0]){if(a[e[0]]&&"_"!=e[0].toString().substr(0,1))return a[e[0]].apply(t,Array.prototype.slice.call(e,1));throw e[0]+" is an invalid value"}return a.init.apply(t,e)};p.extend(p.fn,{flip:function(t,a){return i(this,Z,arguments)},turn:function(t){return i(this,u,arguments)},transform:function(t,a){var e={};return a&&(e[m+"transform-origin"]=a),e[m+"transform"]=t,this.css(e)},animatef:function(e){var i=this.data();if(i.effect&&clearInterval(i.effect.handle),e){e.to.length||(e.to=[e.to]),e.from.length||(e.from=[e.from]),e.easing||(e.easing=function(t,a,e,i,r){return i*Math.sqrt(1-(a=a/r-1)*a)+e});var t,r=[],s=e.to.length,n=this,o=e.fps||30,p=-o,a=function(){var t,a=[];for(p=Math.min(e.duration,p+o),t=0;t<s;t++)a.push(e.easing(1,p,e.from[t],r[t],e.duration));e.frame(1==s?a[0]:a),p==e.duration&&(clearInterval(i.effect.handle),delete i.effect,n.data(i),e.complete&&e.complete())};for(t=0;t<s;t++)r.push(e.to[t]-e.from[t]);i.effect=e,i.effect.handle=setInterval(a,o),this.data(i),a()}else delete i.effect}}),p.isTouch=h}(jQuery);